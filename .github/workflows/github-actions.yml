name: RouteScoring
run-name: containerized testing
on: [push]
jobs:
  Containerized-Integration-Test:
    runs-on: ubuntu-latest
    steps:
      - run: echo "event ${{ github.event_name }}, os ${{ runner.os }}, branch ${{ github.ref }}, repo ${{ github.repository }}"
      - name: Check out repo code
        uses: actions/checkout@v3
      - run: echo "status repo ${{ github.repository }} has been cloned to the runner"
      - name: echo "files in repo"
        run: |
          ls ${{ github.workspaces }}
      - name: Run Test Container
        run: make test
  Integration-Test:
    runs-on: ubuntu-latest
    steps:
      - name: Set up Python 3.7
        uses: actions/setup-python@v4
        with:
          python-version: '3.7'
      - name: Install dependencies
        run: |
          # disable - use container run for now
          exit 0
          python -m pip install --upgrade pipi
          pip install -r requirements.txt
      - name: Integration Test
        run: |
          # disable
          exit 0
          workdir=/home/runner/work/cyclesafe/data
          python --version
          pwd; mkdir $workdir; cp ./t/route_json/gps_generic.json ./data/gps_input_route.json && \
          python3 ./code/model.py --workspace=$workdir --routefile=$PWD/data/gps_input_route.json ;
          set -ex;
          ls -ltr $workdir | grep "gps_input_route.json";
          ls -ltr $workdir | grep  "gps_scored_route.json";
          ls -ltr $workdir | grep  "human_read_dectree.pkl";
          echo "PASS"
      - run: echo "status job status is ${{ job.status }}"
